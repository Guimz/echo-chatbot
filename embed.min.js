(function(){window.echoConfig=window.echoConfig||{webhookUrl:"http://localhost:5678/webhook/chat",appearance:{primaryColor:"#003459",textColor:"#E6E1C5",botName:"Echo Bot",welcomeMessage:"Hello! What is your question?",inputPlaceholder:"Ask your question...",inputTextColor:"#003459",inputHighlightBoxColor:"#003459"},showBranding:!0};const e=document.currentScript,t=e.getAttribute("user_record_id"),n=document.createElement("div");n.id="echo-chat-widget-container",document.body.appendChild(n);const a=document.createElement("script");a.src="https://cdn.tailwindcss.com",document.head.appendChild(a);const o=document.createElement("link");o.rel="stylesheet",o.href="styles.css",document.head.appendChild(o),a.onload=()=>{i()};async function i(){try{if(t){const e=await fetch(`https://echo.saltoai.com/api/brand-config/${t}`);if(!e.ok)return console.warn("Failed to fetch brand config:",e.status,e.statusText),void r();const n=e.headers.get("content-type");if(!n||!n.includes("application/json"))return console.warn("Invalid content type received:",n),void r();const a=await e.json();window.echoConfig={...window.echoConfig,...a}}r()}catch(e){console.warn("Error fetching brand config:",e.message),r()}}function r(){const e=`
    <div id="echo-chat-widget" class="fixed bottom-4 right-4 z-50">
        <!-- Chat Button -->
        <button id="chat-toggle" class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-colors bg-[${window.echoConfig.appearance.primaryColor}]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.appearance.textColor}">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
        </button>

        <!-- Chat Window -->
        <div id="chat-window" class="hidden w-96 h-[600px] bg-white rounded-lg shadow-lg flex flex-col">
            <!-- Chat Header -->
            <div class="p-4 rounded-t-lg flex items-center justify-between" style="background-color: ${window.echoConfig.appearance.primaryColor}">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.appearance.textColor}">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                    <div>
                        <h3 class="text-lg font-semibold" style="color: ${window.echoConfig.appearance.textColor}">${window.echoConfig.appearance.botName}</h3>
                        <div class="text-xs flex items-center" style="color: ${window.echoConfig.appearance.textColor}">
                            <span class="inline-block h-2 w-2 rounded-full bg-green-500 mr-1"></span>
                            Online Now
                        </div>
                    </div>
                </div>
                <button id="close-chat" style="color: ${window.echoConfig.appearance.textColor}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Messages Container -->
            <div id="messages" class="flex-1 p-4 overflow-y-auto flex flex-col gap-2">
                <div class="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto">
                    ${window.echoConfig.appearance.welcomeMessage}
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 border-t">
                <div class="flex gap-2">
                    <input type="text" id="message-input" 
                           class="flex-1 p-2 border rounded-lg"
                           style="color: ${window.echoConfig.appearance.inputTextColor}; outline: none; transition: box-shadow 0.2s;"
                           onfocus="this.style.boxShadow='0 0 0 2px ${window.echoConfig.appearance.inputHighlightBoxColor}'"
                           onblur="this.style.boxShadow='none'"
                           placeholder="${window.echoConfig.appearance.inputPlaceholder}">
                    <button id="send-message" 
                            class="px-4 py-2 rounded-lg transition-colors"
                            style="background-color: ${window.echoConfig.appearance.primaryColor}; color: ${window.echoConfig.appearance.textColor}">
                        Send
                    </button>
                </div>
            </div>

            <!-- Footer -->
            ${window.echoConfig.showBranding?`
            <div class="p-2 text-center text-xs text-gray-500">
                Powered by 
                <img src="salto_ai_logo.png" alt="Salto AI" class="h-4 w-auto mx-1 inline-block">
                Salto AI
            </div>
            `:""}
        </div>
    </div>
`;n.innerHTML=e;const a=document.getElementById("chat-toggle"),o=document.getElementById("chat-window"),i=document.getElementById("close-chat"),r=document.getElementById("message-input"),c=document.getElementById("send-message"),s=document.getElementById("messages");a.addEventListener("click",()=>{o.classList.remove("hidden"),a.classList.add("hidden")}),i.addEventListener("click",()=>{o.classList.add("hidden"),a.classList.remove("hidden")});const l=async()=>{const e=r.value.trim();if(!e)return;const a=document.createElement("div");a.className="p-3 rounded-lg max-w-[75%] ml-auto",a.style.backgroundColor=window.echoConfig.appearance.primaryColor,a.style.color=window.echoConfig.appearance.textColor,a.textContent=e,s.appendChild(a),r.value="",r.disabled=!0,c.disabled=!0;const o=document.createElement("div");o.className="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto",o.textContent=".",s.appendChild(o);let i=1;const l=setInterval(()=>{i=(i%3)+1,o.textContent=".".repeat(i)},500);try{const a=await fetch(window.echoConfig.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",body:JSON.stringify({message:e,user_record_id:t,conversationHistory:Array.from(s.children).filter(e=>e!==o).map(e=>({role:e.classList.contains("ml-auto")?"user":"bot",content:e.textContent}))})});if(console.log("Sending request with user_record_id:",t),!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=await a.json(),r=i.message||i.response||i.output;if(!r)throw new Error("No response from bot");clearInterval(l),s.removeChild(o);const c=document.createElement("div");c.className="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto",c.textContent=r,s.appendChild(c)}catch(e){console.error("Error:",e),clearInterval(l),s.removeChild(o);const t=document.createElement("div");t.className="p-3 rounded-lg max-w-[75%] bg-red-100 text-red-800 mr-auto",t.textContent="Sorry, I encountered an error. Please try again.",s.appendChild(t)}finally{r.disabled=!1,c.disabled=!1,r.focus(),s.scrollTop=s.scrollHeight}};c.addEventListener("click",l),r.addEventListener("keypress",e=>{"Enter"===e.key&&l()})}i()})();