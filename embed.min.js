!function(){window.echoConfig=window.echoConfig||{webhookUrl:"https://n8n.saltoai.com/webhook/chat",primaryColor:"#B9D8F9",textColor:"#003459",botName:"Echo Bot",welcomeMessage:"Hi, I hope you are well, How can I help?",inputPlaceholder:"Ask your question...",inputTextColor:"#003459",inputHighlightBoxColor:"#003459",showBranding:!0,position:"bottom-right"};const e=document.currentScript;window.userRecordId=e.getAttribute("user_record_id");const o=document.createElement("div");o.id="echo-chat-widget-container",document.body.appendChild(o);const t=document.createElement("script");t.src="https://cdn.tailwindcss.com",document.head.appendChild(t);const n=document.createElement("link");async function i(){try{if(userRecordId){const e=await async function(e){try{const o=await fetch(`https://echo-chatbot-config.bruno-e2f.workers.dev/api/config/${e}`);if(!o.ok){if(404===o.status){const e=await o.json();if(e.default)return e.default}return console.warn("Failed to fetch brand config:",o.status,o.statusText),null}return await o.json()}catch(e){return console.error("Error fetching config:",e),null}}(userRecordId);e&&(window.echoConfig={...window.echoConfig,...e})}r()}catch(e){console.warn("Error fetching brand config:",e.message),r()}}function r(){if("string"==typeof window.echoConfig.inputPlaceholder&&window.echoConfig.inputPlaceholder.trim().startsWith("[")&&window.echoConfig.inputPlaceholder.trim().endsWith("]"))try{window.echoConfig.inputPlaceholder=JSON.parse(window.echoConfig.inputPlaceholder)}catch(e){}console.log("inputPlaceholder:",window.echoConfig.inputPlaceholder,"Type:",typeof window.echoConfig.inputPlaceholder,"IsArray:",Array.isArray(window.echoConfig.inputPlaceholder));const e=`\n            <div id="echo-chat-widget" class="${(()=>{switch((window.echoConfig.position||"bottom-right").toLowerCase()){case"bottom-left":return"fixed bottom-4 left-4";case"top-right":return"fixed top-4 right-4";case"top-left":return"fixed top-4 left-4";default:return"fixed bottom-4 right-4"}})()} z-50">\n                \x3c!-- Chat Button --\x3e\n                <button id="chat-toggle" class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-colors bg-[${window.echoConfig.primaryColor}]">\n                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.textColor}">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />\n                    </svg>\n                </button>\n\n                \x3c!-- Chat Window --\x3e\n                <div id="chat-window" class="hidden w-96 h-[600px] bg-white rounded-lg shadow-lg flex flex-col overflow-hidden" style="font-size: 14px; line-height: 1.4;">\n                    \x3c!-- Chat Header --\x3e\n                    <div class="p-4 flex items-center justify-between" style="background-color: ${window.echoConfig.primaryColor}">\n                        <div class="flex items-center gap-2">\n                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.textColor}">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />\n                            </svg>\n                            <div>\n                                <h3 class="text-lg font-semibold" style="color: ${window.echoConfig.textColor}">${window.echoConfig.botName}</h3>\n                                <div class="text-xs flex items-center" style="color: ${window.echoConfig.textColor}">\n                                    <span class="inline-block h-2 w-2 rounded-full bg-green-500 mr-1"></span>\n                                    Online Now\n                                </div>\n                            </div>\n                        </div>\n                        <button id="close-chat" style="color: ${window.echoConfig.textColor}">\n                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n                            </svg>\n                        </button>\n                    </div>\n\n                    \x3c!-- Messages Container --\x3e\n                    <div id="messages" class="flex-1 pt-1 pr-3 pb-4 pl-3 overflow-y-auto flex flex-col gap-0.3">\n                        <div class="flex flex-col items-start max-w-[75%] mr-auto">\n                            <div class="text-xs text-gray-400 mb-0.5">${window.echoConfig.botName}</div>\n                            <div class="p-3 rounded-lg bg-gray-100 text-gray-800 w-full">\n                                ${window.echoConfig.welcomeMessage}\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Input Area --\x3e\n                    <div class="p-4 border-t">\n                        <div class="flex gap-2">\n                            <input type="text" id="message-input" \n                                   class="flex-1 p-2 border rounded-lg"\n                                   style="color: ${window.echoConfig.inputTextColor}; outline: none; transition: box-shadow 0.2s;"\n                                   onfocus="this.style.boxShadow='0 0 0 2px ${window.echoConfig.inputHighlightBoxColor}'"\n                                   onblur="this.style.boxShadow='none'"\n                                   placeholder="${Array.isArray(window.echoConfig.inputPlaceholder)?"":window.echoConfig.inputPlaceholder}">\n                            <button id="send-message" \n                                    class="px-4 py-2 rounded-lg transition-colors font-semibold"\n                                    style="background-color: ${window.echoConfig.primaryColor}; color: ${window.echoConfig.textColor}">\n                                Send\n                            </button>\n                        </div>\n                    </div>\n\n                    \x3c!-- Footer --\x3e\n                    ${window.echoConfig.showBranding?'\n                    <div class="p-2 text-center text-xs text-gray-500">\n                        Powered by \n                        <img src="https://chat.echo.saltoai.com/salto_ai_logo.png" alt="Salto AI" class="h-4 w-auto mx-1 inline-block">\n                        Salto AI\n                    </div>\n                    ':""}\n                </div>\n            </div>\n        `;o.innerHTML=e;const t=document.getElementById("chat-toggle"),n=document.getElementById("chat-window"),i=document.getElementById("close-chat"),r=document.getElementById("message-input"),s=document.getElementById("send-message"),l=document.getElementById("messages");function c(){l.scrollTop=l.scrollHeight}let d;Array.isArray(window.echoConfig.inputPlaceholder)?d=function(e,o){let t,n=0,i=!0,r=0;return function s(){if(!Array.isArray(e)||0===e.length)return;const l=e[n];i?r<l.length?(o.setAttribute("placeholder",l.slice(0,r+1)),r++,t=setTimeout(s,60)):(i=!1,t=setTimeout(s,1200)):r>0?(o.setAttribute("placeholder",l.slice(0,r-1)),r--,t=setTimeout(s,30)):(i=!0,n=(n+1)%e.length,t=setTimeout(s,400))}(),()=>clearTimeout(t)}(window.echoConfig.inputPlaceholder,r):r.setAttribute("placeholder",window.echoConfig.inputPlaceholder||"Ask your question..."),t.addEventListener("click",(()=>{n.classList.remove("hidden"),t.classList.add("hidden"),c()})),i.addEventListener("click",(()=>{n.classList.add("hidden"),t.classList.remove("hidden")}));const a=async()=>{const e=r.value.trim();if(!e)return;const o=document.createElement("div");o.className="p-3 rounded-lg max-w-[75%] ml-auto",o.style.backgroundColor=window.echoConfig.primaryColor,o.style.color=window.echoConfig.textColor,o.textContent=e,l.appendChild(o),c(),r.value="",r.disabled=!0,s.disabled=!0;const t=document.createElement("div");t.className="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto",t.textContent=".",l.appendChild(t),c();let n=1;const i=setInterval((()=>{n=n%3+1,t.textContent=".".repeat(n)}),500);try{const o=await fetch(window.echoConfig.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},mode:"cors",body:JSON.stringify({message:e,user_record_id:window.userRecordId,conversationHistory:Array.from(l.children).filter((e=>e!==t)).map((e=>({role:e.classList.contains("ml-auto")?"user":"bot",content:e.textContent})))})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json(),r=n.message||n.response||n.output;if(!r)throw new Error("No response from bot");clearInterval(i),l.removeChild(t);const s=document.createElement("div");s.className="flex flex-col items-start max-w-[75%] mr-auto";const d=document.createElement("div");d.className="text-xs text-gray-400 mb-0.5",d.textContent=window.echoConfig.botName,s.appendChild(d);const a=document.createElement("div");a.className="p-3 rounded-lg bg-gray-100 text-gray-800 w-full",a.textContent=r,s.appendChild(a),l.appendChild(s),c()}catch(e){console.error("Error:",e),clearInterval(i),l.removeChild(t);const o=document.createElement("div");o.className="p-3 rounded-lg max-w-[75%] bg-red-100 text-red-800 mr-auto",o.textContent="Sorry, I encountered an error. Please try again.",l.appendChild(o),c()}finally{r.disabled=!1,s.disabled=!1,r.focus(),c()}};s.addEventListener("click",a),r.addEventListener("keypress",(e=>{"Enter"===e.key&&a()}))}n.rel="stylesheet",n.href="https://chat.echo.saltoai.com/styles.css",document.head.appendChild(n),t.onload=()=>{i()},i()}();