!function(){window.echoConfig=window.echoConfig||{webhookUrl:"http://localhost:5678/webhook/chat",appearance:{primaryColor:"#003459",textColor:"#E6E1C5",botName:"Echo Bot",welcomeMessage:"Hello! What is your question?",inputPlaceholder:"Ask your question...",inputTextColor:"#003459",inputHighlightBoxColor:"#003459"},showBranding:!0};const e=document.currentScript,t=e.getAttribute("user_record_id"),n=document.createElement("div");n.id="echo-chat-widget-container",document.body.appendChild(n);const o=document.createElement("script");o.src="https://cdn.tailwindcss.com",document.head.appendChild(o);const r=document.createElement("link");r.rel="stylesheet",r.href="styles.css",document.head.appendChild(r),o.onload=()=>{initializeWidget()};async function initializeWidget(){try{if(t){const e=await fetch(`https://echo.saltoai.com/api/brand-config/${t}`);if(!e.ok)return void(console.warn("Failed to fetch brand config:",e.status,e.statusText),createWidget());const n=e.headers.get("content-type");if(!n||!n.includes("application/json"))return void(console.warn("Invalid content type received:",n),createWidget());const o=await e.json();window.echoConfig={...window.echoConfig,...o}}createWidget()}catch(e){console.warn("Error fetching brand config:",e.message),createWidget()}}function createWidget(){const e=document.createElement("div");e.innerHTML=`<div id="echo-chat-widget" class="fixed bottom-4 right-4 z-50"><button id="chat-toggle" class="w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-colors" style="background-color:${window.echoConfig.appearance.primaryColor}"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.appearance.textColor}"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg></button><div id="chat-window" class="hidden w-96 h-[600px] bg-white rounded-lg shadow-lg flex flex-col"><div class="p-4 rounded-t-lg flex items-center justify-between" style="background-color:${window.echoConfig.appearance.primaryColor}"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="${window.echoConfig.appearance.textColor}"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg><div><h3 class="text-lg font-semibold" style="color:${window.echoConfig.appearance.textColor}">${window.echoConfig.appearance.botName}</h3><div class="text-xs flex items-center" style="color:${window.echoConfig.appearance.textColor}"><span class="inline-block h-2 w-2 rounded-full bg-green-500 mr-1"></span>Online Now</div></div></div><button id="close-chat" style="color:${window.echoConfig.appearance.textColor}"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><div id="messages" class="flex-1 p-4 overflow-y-auto flex flex-col gap-2"><div class="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto">${window.echoConfig.appearance.welcomeMessage}</div></div><div class="p-4 border-t"><div class="flex gap-2"><input type="text" id="message-input" class="flex-1 p-2 border rounded-lg" style="color:${window.echoConfig.appearance.inputTextColor};outline:none;transition:box-shadow 0.2s;" onfocus="this.style.boxShadow='0 0 0 2px ${window.echoConfig.appearance.inputHighlightBoxColor}'" onblur="this.style.boxShadow='none'" placeholder="${window.echoConfig.appearance.inputPlaceholder}"><button id="send-message" class="px-4 py-2 rounded-lg transition-colors" style="background-color:${window.echoConfig.appearance.primaryColor};color:${window.echoConfig.appearance.textColor}">Send</button></div></div>${window.echoConfig.showBranding?`<div class="p-2 text-center text-xs text-gray-500">Powered by <img src="salto_ai_logo.png" alt="Salto AI" class="h-4 w-auto mx-1 inline-block">Salto AI</div>`:""}</div></div>`,n.appendChild(e);const t=document.getElementById("chat-toggle"),o=document.getElementById("chat-window"),r=document.getElementById("close-chat"),i=document.getElementById("message-input"),a=document.getElementById("send-message"),c=document.getElementById("messages");t.addEventListener("click",()=>{o.classList.remove("hidden"),t.classList.add("hidden")}),r.addEventListener("click",()=>{o.classList.add("hidden"),t.classList.remove("hidden")});const s=async()=>{const e=i.value.trim();if(!e)return;const t=document.createElement("div");t.className="p-3 rounded-lg max-w-[75%] ml-auto",t.style.backgroundColor=window.echoConfig.appearance.primaryColor,t.style.color=window.echoConfig.appearance.textColor,t.textContent=e,c.appendChild(t),i.value="",i.disabled=!0,a.disabled=!0;const n=document.createElement("div");n.className="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto",n.textContent=".",c.appendChild(n);let o=1;const r=setInterval(()=>{o=(o%3)+1,n.textContent=".".repeat(o)},500);try{const t=await fetch(window.echoConfig.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json","Accept":"application/json"},mode:"cors",body:JSON.stringify({message:e,user_record_id:userRecordId,conversationHistory:Array.from(c.children).filter(e=>e!==n).map(e=>({role:e.classList.contains("ml-auto")?"user":"bot",content:e.textContent}))})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json(),s=i.message||i.response||i.output;if(!s)throw new Error("No response from bot");clearInterval(r),c.removeChild(n);const d=document.createElement("div");d.className="p-3 rounded-lg max-w-[75%] bg-gray-100 text-gray-800 mr-auto",d.textContent=s,c.appendChild(d)}catch(e){console.error("Error:",e),clearInterval(r),c.removeChild(n);const t=document.createElement("div");t.className="p-3 rounded-lg max-w-[75%] bg-red-100 text-red-800 mr-auto",t.textContent="Sorry, I encountered an error. Please try again.",c.appendChild(t)}finally{i.disabled=!1,a.disabled=!1,i.focus(),c.scrollTop=c.scrollHeight}};a.addEventListener("click",s),i.addEventListener("keypress",e=>{"Enter"===e.key&&s()})}}(); 